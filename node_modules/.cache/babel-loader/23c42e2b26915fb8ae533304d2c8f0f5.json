{"ast":null,"code":"var _jsxFileName = \"/Users/vasmish/Coding/rollingScopesRSS/async-race/RSS-async-race/src/components/CarsList.tsx\";\nimport CarItem from './CarItem';\nimport { Winner } from '../model/Car';\nimport * as api from '../api-fetch/requests';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\n\nconst CarsList = props => {\n  console.log('CARS LIST');\n  const racers = [];\n\n  const processRacer = racer => {\n    racers.push(racer);\n\n    if (racers.length === props.items.length) {\n      props.signalRaceEnded();\n      const successfulRacers = racers.filter(racer => racer.success);\n      console.log(successfulRacers);\n      const bestRacer = successfulRacers.reduce((curr, acc) => curr.time < acc.time ? curr : acc);\n      console.log(bestRacer);\n      const winner = new Winner(bestRacer.id, 1, bestRacer.time);\n      console.log('WINNER', winner); // check if such winner exists\n      // YES: updateWinner\n      // No: createWinner\n\n      api.getWinner(winner.id).then(res => {\n        if (res.ok) {\n          // updateWinner\n          res.json().then(oldRecord => {\n            const wins = oldRecord.wins + winner.wins;\n            const time = oldRecord.time > winner.time ? winner.time : oldRecord.time;\n            api.updateWinner(new Winner(winner.id, wins, time));\n          });\n        } else {\n          // createWinner\n          api.createWinner(winner);\n        }\n      });\n    }\n  };\n\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    children: /*#__PURE__*/_jsxDEV(\"ul\", {\n      children: props.items.map(item => /*#__PURE__*/_jsxDEV(CarItem, {\n        item: item,\n        isRaceStarted: props.isRaceStarted,\n        onRemove: props.removeCarHandler,\n        onSelect: props.selectCarHandler,\n        dispatchRacer: processRacer\n      }, item.id, false, {\n        fileName: _jsxFileName,\n        lineNumber: 51,\n        columnNumber: 11\n      }, this))\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 49,\n      columnNumber: 7\n    }, this)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 48,\n    columnNumber: 5\n  }, this);\n};\n\n_c = CarsList;\nexport default CarsList;\n\nvar _c;\n\n$RefreshReg$(_c, \"CarsList\");","map":{"version":3,"names":["CarItem","Winner","api","CarsList","props","console","log","racers","processRacer","racer","push","length","items","signalRaceEnded","successfulRacers","filter","success","bestRacer","reduce","curr","acc","time","winner","id","getWinner","then","res","ok","json","oldRecord","wins","updateWinner","createWinner","map","item","isRaceStarted","removeCarHandler","selectCarHandler"],"sources":["/Users/vasmish/Coding/rollingScopesRSS/async-race/RSS-async-race/src/components/CarsList.tsx"],"sourcesContent":["import CarItem from './CarItem';\nimport Car, { Winner } from '../model/Car';\nimport { Racer } from '../model/Car';\nimport * as api from '../api-fetch/requests';\n\ninterface TCarListProps {\n  items: Car[];\n  removeCarHandler: (id: number) => void;\n  selectCarHandler: (item: Car) => void;\n  isRaceStarted: boolean;\n  signalRaceEnded: () => void;\n}\n\nconst CarsList: React.FC<TCarListProps> = (props) => {\n  console.log('CARS LIST');\n  const racers: Racer[] = [];\n\n  const processRacer = (racer: Racer) => {\n    racers.push(racer);\n    if (racers.length === props.items.length) {\n      props.signalRaceEnded();\n      const successfulRacers = racers.filter((racer) => racer.success);\n      console.log(successfulRacers);\n      const bestRacer = successfulRacers.reduce((curr, acc) => (curr.time < acc.time ? curr : acc));\n      console.log(bestRacer);\n      const winner = new Winner(bestRacer.id, 1, bestRacer.time);\n      console.log('WINNER', winner);\n      // check if such winner exists\n      // YES: updateWinner\n      // No: createWinner\n      api.getWinner(winner.id).then((res) => {\n        if (res.ok) {\n          // updateWinner\n          res.json().then((oldRecord) => {\n            const wins = oldRecord.wins + winner.wins;\n            const time = oldRecord.time > winner.time ? winner.time : oldRecord.time;\n            api.updateWinner(new Winner(winner.id, wins, time));\n          });\n        } else {\n          // createWinner\n          api.createWinner(winner);\n        }\n      });\n    }\n  };\n\n  return (\n    <div>\n      <ul>\n        {props.items.map((item) => (\n          <CarItem\n            key={item.id}\n            item={item}\n            isRaceStarted={props.isRaceStarted}\n            onRemove={props.removeCarHandler}\n            onSelect={props.selectCarHandler}\n            dispatchRacer={processRacer}\n          />\n        ))}\n      </ul>\n    </div>\n  );\n};\nexport default CarsList;\n"],"mappings":";AAAA,OAAOA,OAAP,MAAoB,WAApB;AACA,SAAcC,MAAd,QAA4B,cAA5B;AAEA,OAAO,KAAKC,GAAZ,MAAqB,uBAArB;;;AAUA,MAAMC,QAAiC,GAAIC,KAAD,IAAW;EACnDC,OAAO,CAACC,GAAR,CAAY,WAAZ;EACA,MAAMC,MAAe,GAAG,EAAxB;;EAEA,MAAMC,YAAY,GAAIC,KAAD,IAAkB;IACrCF,MAAM,CAACG,IAAP,CAAYD,KAAZ;;IACA,IAAIF,MAAM,CAACI,MAAP,KAAkBP,KAAK,CAACQ,KAAN,CAAYD,MAAlC,EAA0C;MACxCP,KAAK,CAACS,eAAN;MACA,MAAMC,gBAAgB,GAAGP,MAAM,CAACQ,MAAP,CAAeN,KAAD,IAAWA,KAAK,CAACO,OAA/B,CAAzB;MACAX,OAAO,CAACC,GAAR,CAAYQ,gBAAZ;MACA,MAAMG,SAAS,GAAGH,gBAAgB,CAACI,MAAjB,CAAwB,CAACC,IAAD,EAAOC,GAAP,KAAgBD,IAAI,CAACE,IAAL,GAAYD,GAAG,CAACC,IAAhB,GAAuBF,IAAvB,GAA8BC,GAAtE,CAAlB;MACAf,OAAO,CAACC,GAAR,CAAYW,SAAZ;MACA,MAAMK,MAAM,GAAG,IAAIrB,MAAJ,CAAWgB,SAAS,CAACM,EAArB,EAAyB,CAAzB,EAA4BN,SAAS,CAACI,IAAtC,CAAf;MACAhB,OAAO,CAACC,GAAR,CAAY,QAAZ,EAAsBgB,MAAtB,EAPwC,CAQxC;MACA;MACA;;MACApB,GAAG,CAACsB,SAAJ,CAAcF,MAAM,CAACC,EAArB,EAAyBE,IAAzB,CAA+BC,GAAD,IAAS;QACrC,IAAIA,GAAG,CAACC,EAAR,EAAY;UACV;UACAD,GAAG,CAACE,IAAJ,GAAWH,IAAX,CAAiBI,SAAD,IAAe;YAC7B,MAAMC,IAAI,GAAGD,SAAS,CAACC,IAAV,GAAiBR,MAAM,CAACQ,IAArC;YACA,MAAMT,IAAI,GAAGQ,SAAS,CAACR,IAAV,GAAiBC,MAAM,CAACD,IAAxB,GAA+BC,MAAM,CAACD,IAAtC,GAA6CQ,SAAS,CAACR,IAApE;YACAnB,GAAG,CAAC6B,YAAJ,CAAiB,IAAI9B,MAAJ,CAAWqB,MAAM,CAACC,EAAlB,EAAsBO,IAAtB,EAA4BT,IAA5B,CAAjB;UACD,CAJD;QAKD,CAPD,MAOO;UACL;UACAnB,GAAG,CAAC8B,YAAJ,CAAiBV,MAAjB;QACD;MACF,CAZD;IAaD;EACF,CA3BD;;EA6BA,oBACE;IAAA,uBACE;MAAA,UACGlB,KAAK,CAACQ,KAAN,CAAYqB,GAAZ,CAAiBC,IAAD,iBACf,QAAC,OAAD;QAEE,IAAI,EAAEA,IAFR;QAGE,aAAa,EAAE9B,KAAK,CAAC+B,aAHvB;QAIE,QAAQ,EAAE/B,KAAK,CAACgC,gBAJlB;QAKE,QAAQ,EAAEhC,KAAK,CAACiC,gBALlB;QAME,aAAa,EAAE7B;MANjB,GACO0B,IAAI,CAACX,EADZ;QAAA;QAAA;QAAA;MAAA,QADD;IADH;MAAA;MAAA;MAAA;IAAA;EADF;IAAA;IAAA;IAAA;EAAA,QADF;AAgBD,CAjDD;;KAAMpB,Q;AAkDN,eAAeA,QAAf"},"metadata":{},"sourceType":"module"}